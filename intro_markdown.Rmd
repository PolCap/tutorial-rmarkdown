---
title: "Workshop Medrecover-UB"
date: "`r Sys.Date()`"
author: 
  - Pol Capdevila^[Universitat de Barcelona, pcapdevila@ub.edu]
output: 
    html_document:
      toc: true
      toc_float: true
      theme: paper
      highlight: pygments
      code_folding: show
      df_print: paged
bibliography: references.bib
csl: apa.csl
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning=FALSE, message=FALSE)
```

<style type="text/css">

body, td {
   font-size: 20px;
}
code.r{
  font-size: 16px;
}
pre {
  font-size: 16px
}
body {
text-align: justify}
</style>

All the content of this tutorial has been extracted from [this book](https://bookdown.org/yihui/rmarkdown/), [this tutorial](https://epirhandbook.com/new_pages/rmarkdown.html) and with the unconditional assistance of chatgpt.   

# What is RMarkdown?

Markdown is a “language” that allows you to write a document using plain text, that can be converted to html and other formats. It is not specific to R. Files written in Markdown have a `.md` extension.

R Markdown is a variation on markdown that is specific to R - it allows you to write a document using markdown to produce text and to embed R code and display their outputs. R Markdown files have `.Rmd` extension.

`rmarkdown` is the package used by R to render the `.Rmd` file into the desired output. It’s focus is converting the markdown (text) syntax, so we also need `knitr`, the R package that will read the code chunks, execute it, and ‘knit’ it back into the document. This is how tables and graphs are included alongside the text.
`Pandoc`is the program actually converting the output into word/pdf/powerpoint etc. It is a software separate from R but is installed automatically with RStudio.

<center>

![](images/figure1.png)
</center>

In sum, the process that happens in the background (you do not need to know all these steps!) involves feeding the .Rmd file to knitr, which executes the R code chunks and creates a new .md (markdown) file which includes the R code and its rendered output. The .md file is then processed by pandoc to create the finished product: a Microsoft Word document, HTML file, powerpoint document, pdf, etc.

<center>

![](images/figure2.png)
</center>

# Installing RMarkdown

To run RMarkdown you need to have R installed (https://www.r-project.org) (R Core Team 2023) and the RStudio IDE (https://www.rstudio.com). RStudio is not required but recommended, because it makes it easier for an average user to work with R Markdown. If you do not have RStudio IDE installed, you will have to install Pandoc (http://pandoc.org), otherwise there is no need to install Pandoc separately because RStudio has bundled it. Next you can install the rmarkdown package in R:

```{r instalaltion, eval=F}
# Install from CRAN
install.packages('rmarkdown')

# Or if you want to test the development version,
# install from GitHub
if (!requireNamespace("devtools"))
  install.packages('devtools')
devtools::install_github('rstudio/rmarkdown')
``` 

If you want to generate PDF output, you will need to install `LaTeX`, one way to start could be using `TinyTeX` (https://yihui.name/tinytex/):

```{r LateX,  eval=F}
install.packages('tinytex')
tinytex::install_tinytex()  # install TinyTeX
```

With the rmarkdown package, RStudio/Pandoc, and LaTeX, you should be able to compile most R Markdown documents. In some cases, you may need other software packages.

# Setting Up RMarkdown

To create an RMarkdown document in RStudio:

1. Click **File** > **New File** > **R Markdown**.

<center>
![](images/figure3.png)
</center>

2. Choose **Document** and select **HTML** output.

<center>

![](images/figure4.png)

</center>

3. Click **OK** to generate a template.

# Parts of a RMarkdown 

An R Markdown document has three basic "parts": YAML, Markdown text, and code chunks.

![](images/figure5.png)

We are now going to explore these different parts a bit more in detail.

## YAML metadata

Referred to as the ‘YAML metadata’ or just ‘YAML’, this is at the top of the R Markdown document. This section of the script will tell your Rmd file what type of output to produce, formatting preferences, and other metadata such as document title, author, and date. There are other uses not mentioned here (but referred to in ‘Producing an output’). Note that indentation matters; tabs are not accepted but spaces are.

This section must begin with a line containing just three dashes --- and must close with a line containing just three dashes ---. YAML parameters comes in key:value pairs. The placement of colons in YAML is important - the key:value pairs are separated by colons (not equals signs!).

The YAML should begin with metadata for the document. The order of these primary YAML parameters (not indented) does not matter. For example:

```{yaml, eval=FALSE}
title: "My document"
author: "Me"
date: "2024-09-18"
```
You can use R code in YAML values by writing it as in-line code (preceded by r within back-ticks) but also within quotes (see above example for `date:`).

In the image above, because we clicked that our default output would be an html file, we can see that the YAML says `output: html_document`. However we can also change this to say `powerpoint_presentation` or `word_document` or even `pdf_document`.

You will notice that I used in these case a longer code:

```{yaml, eval=FALSE}   
      toc: true
      toc_float: true
      theme: paper
      highlight: pygments
      code_folding: show
      df_print: paged
bibliography: references.bib
csl: apa.csl
```

These parts are simply formatting details for the document: 

- `toc: true`: Adds a table of contents at the beginning of your document.
- `toc_float: true`: Makes the TOC float on the side of the page as you scroll (useful for navigation in long documents).
- `theme: paper`: Sets the theme of the HTML document. The "paper" theme provides a clean, simple, and minimalistic look.
- `highlight: pygments`: Specifies the syntax highlighting style for code blocks. "pygments" is one of the available styles for code syntax highlighting.
- `code_folding: show`: Allows code folding, meaning users can collapse or expand code chunks in the knitted HTML output. "show" means the code is visible by default but can be hidden by clicking a button.
- `df_print: paged`: When printing data frames in the HTML output, this setting displays them in a paged table format with pagination (rather than printing them as plain text). This is useful for handling large data frames.
- `bibliography: references.bib` and `csl: apa.csl` are related to the bibliography and will be explained later.

## Text

This is the narrative of your document, including the titles and headings. It is written in the “markdown” language, which is used across many different software.

Below are the core ways to write this text. See more extensive documentation available on R Markdown “cheatsheet” at the RStudio website.

### New lines

Uniquely in R Markdown, to initiate a new line, enter *two spaces** at the end of the previous line and then Enter/Return.  

### Case

Surround your normal text with these character to change how it appears in the output.

- **Bold**: `**bold text**`
- *Italic*: `*italic text*`
- `Monospace`: `` `code` ``
- Bullet points: `- Item 1`, `- Item 2`
- Headers: `# Heading 1`, `## Heading 2`, `### Heading 3`
- Blockquotes:
  > This is a blockquote.
  
- Inline code: `r inline_code_example <- 42`

The actual appearance of the font can be set by using specific templates (specified in the YAML metadata).

### Color

There is no simple mechanism to change the color of text in R Markdown. One work-around, IF your output is an HTML file, is to add an HTML line into the markdown text. The below HTML code will print a line of text in bold red.

```{html}
<span style="color: red;">**_DANGER:_** This is a warning.</span>  
``` 

<span style="color: red;">**_DANGER:_** This is a warning.</span>  

### Titles and headings

A hash symbol in a text portion of a R Markdown script creates a heading. This is different than in a chunk of R code in the script, in which a hash symbol is a mechanism to comment/annotate/de-activate, as in a normal R script.

Different heading levels are established with different numbers of hash symbols at the start of a new line. One hash symbol is a title or primary heading. Two hash symbols are a second-level heading. Third- and fourth-level headings can be made with successively more hash symbols.

### Bullets and numbering

Use asterisks (*) to created a bullets list. Finish the previous sentence, enter two spaces, Enter/Return twice, and then start your bullets. Include a space between the asterisk and your bullet text. After each bullet enter two spaces and then Enter/Return. Sub-bullets work the same way but are indented. Numbers work the same way but instead of an asterisk, write 1), 2), etc. Below is how your R Markdown script text might look.

Here are my bullets (there are two spaces after this colon):  

* Bullet 1 (followed by two spaces and Enter/Return)  
* Bullet 2 (followed by two spaces and Enter/Return)  
  * Sub-bullet 1 (followed by two spaces and Enter/Return)  
  * Sub-bullet 2 (followed by two spaces and Enter/Return)  

### Images

You can include images in your R Markdown one of two ways:

```
![]("path/to/image.png")  
```

If the above does not work, try using `knitr::include_graphics()`

```
knitr::include_graphics("path/to/image.png")
```

### Tables

Create a table using hyphens ( - ) and bars ( | ). The number of hyphens before/between bars allow the number of spaces in the cell before the text begins to wrap.

This code:

![](images/figure6.png)

produces this table: 

Column 1 |Column  2 |Column 3
---------|----------|--------
Cell A   |Cell B    |Cell C
Cell D   |Cell E    |Cell F

You can also add tables using the `knitr::kable` function:

```{r table example}
library(knitr)
df <- data.frame(Name = c("Alice", "Bob"), Age = c(25, 30))
kable(df)
```


### Mathematical Equations
RMarkdown supports LaTeX-style mathematical equations. You can write inline equations using `$...$`, like this: $N_{t+1} = N_t e^{rt}$. 

For display equations, use double dollar signs:

$$
N_{t+1} = N_t e^{rt}
$$

where:
- \( N_t+1 \) is the population at time \( t+1 \),
- \( N_t \) is the initial population,
- \( r \) is the growth rate,
- \( t \) is time.

### Citing Papers
You can cite papers using a bibliography file in BibTeX format. First, create a file called `references.bib`. 
In RStudio, go to File > New File > Text File. Copy and paste the following BibTeX entry format into the new file:

```
@article{smith2020,
  author = {John Smith},
  title = {An Introduction to RMarkdown},
  journal = {Journal of R},
  year = {2020},
  volume = {10},
  pages = {1-10}
}
```
Save the file as `references.bib` in the same directory as your RMarkdown document.

Then, you can cite the paper in your document using `@smith2020`, like this:

> RMarkdown is a great tool for reproducible research [@smith2020].

The references will be automatically formatted at the end of your document.

For this to work make sure you have the `apa.csl` file in the same directory as your RMarkdown document. If you don’t have it, you can download it from the Zotero repository:

1. Go to [CSL Repository](https://www.zotero.org/styles?q=apa). 
2. Search for APA (American Psychological Association) 7th edition.
3. Download the `.csl` file.
4. Place it in the same folder as your `.Rmd` file.


## R Code in RMarkdown

ections of the script that are dedicated to running R code are called “chunks”. This is where you may load packages, import data, and perform the actual data management and visualisation. There may be many code chunks, so they can help you organize your R code into parts, perhaps interspersed with text. To note: These ‘chunks’ will appear to have a slightly different background colour from the narrative part of the document.

Each chunk is opened with a line that starts with three back-ticks, and curly brackets that contain parameters for the chunk ({ }). The chunk ends with three more back-ticks.

Some notes about the contents of the curly brackets { }:

They start with ‘r’ to indicate that the language name within the chunk is R. After the r you can optionally write a chunk “name” – these are not necessary but can help you organise your work. Note that if you name your chunks, you should ALWAYS use unique names or else R will complain when you try to render.

The curly brackets can include other options too, written as tag=value, such as:

- `eval = FALSE` to not run the R code
- `echo = FALSE` to not print the chunk’s R source code in the output document
- `warning = FALSE` to not print warnings produced by the R code
- `message = FALSE` to not print any messages produced by the R code
- `include = either TRUE/FALSE` whether to include chunk outputs (e.g. plots) in the document
- `out.width =` and `out.height =` provide in style out.width = "75%"
- `fig.align = "center"` adjust how a figure is aligned across the page
- `fig.show='hold'` if your chunk prints multiple figures and you want them printed next to each other (pair with  `out.width = c("33%", "67%")`). Can also set as `fig.show='asis'` to show them below the code that generates them, 'hide' to hide, or 'animate' to concatenate multiple into an animation.
- A chunk header must be written in one line
- Try to avoid periods, underscores, and spaces. Use hyphens ( - ) instead if you need a separator.

[More here](https://yihui.org/knitr/options/).

Some of the above options can be configured using the setting buttons at the top right of the chunk. Here, you can specify which parts of the chunk you want the rendered document to include, namely the code, the outputs, and the warnings. This will come out as written preferences within the curly brackets, e.g. `echo=FALSE` if you specify you want to ‘Show output only’.

![](images/figure7.png)

For global options to be applied to all chunks in the script, you can set this up within your very first R code chunk in the script. For instance, so that only the outputs are shown for each code chunk and not the code itself, you can include this command in the R code chunk:

```{r example, eval=FALSE}
knitr::opts_chunk$set(echo = FALSE) 
```

### Run basic code 

To run R code in an RMarkdown document, use R code chunks. A basic chunk looks like this:

```{r caculation}
# Simple Calculation
2 + 2
```

You can also assign variables and print output:
```{r object}
x <- 10
y <- 5
x * y
```

### Plotting in RMarkdown

You can embed plots using `ggplot2` or base R plotting functions.

```{r figure, fig.width=5, fig.height=4}
library(ggplot2)
ggplot(mtcars, aes(x = mpg, y = hp)) +
  geom_point() +
  theme_minimal()
```

Another example using base R:
```{r}
plot(mtcars$mpg, mtcars$hp, main="MPG vs HP", xlab="Miles per Gallon", ylab="Horsepower", col="blue")
```

### Wide Code Blocks
Use `tidy = TRUE` to ensure readable formatting in long code blocks:

```{r, tidy=TRUE}
# A longer code snippet
long_vector <- rep(1:10, each=3)
summary(long_vector)
```


# References 
