---
title: "Workshop Medrecover-UB"
date: "`r Sys.Date()`"
author: 
  - Pol Capdevila^[Universitat de Barcelona, pcapdevila@ub.edu]
output: 
    html_document:
      toc: true
      toc_float: true
      theme: paper
      highlight: pygments
      code_folding: show
      df_print: paged
bibliography: references.bib
csl: apa.csl
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning=FALSE, message=FALSE)
```

<style type="text/css">

body, td {
   font-size: 20px;
}
code.r{
  font-size: 16px;
}
pre {
  font-size: 16px
}
body {
text-align: justify}
</style>

```{=html}
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>
```

All the content of this tutorial has been extracted from [this book](https://bookdown.org/yihui/rmarkdown/), [this tutorial](https://epirhandbook.com/new_pages/rmarkdown.html) and with the unconditional assistance of chatgpt.   

# What is RMarkdown?

Markdown is a “language” that allows you to write a document using plain text, that can be converted to html and other formats. It is not specific to R. Files written in Markdown have a `.md` extension.

R Markdown is a variation on markdown that is specific to R - it allows you to write a document using markdown to produce text and to embed R code and display their outputs. R Markdown files have `.Rmd` extension.

`rmarkdown` is the package used by R to render the `.Rmd` file into the desired output. It’s focus is converting the markdown (text) syntax, so we also need `knitr`, the R package that will read the code chunks, execute it, and ‘knit’ it back into the document. This is how tables and graphs are included alongside the text.
`Pandoc`is the program actually converting the output into word/pdf/powerpoint etc. It is a software separate from R but is installed automatically with RStudio.

<center>

![](images/figure1.png)
</center>

In sum, the process that happens in the background (you do not need to know all these steps!) involves feeding the .Rmd file to knitr, which executes the R code chunks and creates a new .md (markdown) file which includes the R code and its rendered output. The .md file is then processed by pandoc to create the finished product: a Microsoft Word document, HTML file, powerpoint document, pdf, etc.

<center>

![](images/figure2.png)
</center>

# Installing RMarkdown

To run RMarkdown you need to have R installed (https://www.r-project.org) (R Core Team 2023) and the RStudio IDE (https://www.rstudio.com). RStudio is not required but recommended, because it makes it easier for an average user to work with R Markdown. If you do not have RStudio IDE installed, you will have to install Pandoc (http://pandoc.org), otherwise there is no need to install Pandoc separately because RStudio has bundled it. Next you can install the rmarkdown package in R:

```{r instalaltion, eval=F}
# Install from CRAN
install.packages('rmarkdown')

# Or if you want to test the development version,
# install from GitHub
if (!requireNamespace("devtools"))
  install.packages('devtools')
devtools::install_github('rstudio/rmarkdown')
``` 

If you want to generate PDF output, you will need to install `LaTeX`, one way to start could be using `TinyTeX` (https://yihui.name/tinytex/):

```{r LateX,  eval=F}
install.packages('tinytex')
tinytex::install_tinytex()  # install TinyTeX
```

With the rmarkdown package, RStudio/Pandoc, and LaTeX, you should be able to compile most R Markdown documents. In some cases, you may need other software packages.

# Setting Up RMarkdown

To create an RMarkdown document in RStudio:

1. Click **File** > **New File** > **R Markdown**.

<center>
![](images/figure3.png)
</center>

2. Choose **Document** and select **HTML** output.

<center>

![](images/figure4.png)

</center>

3. Click **OK** to generate a template.

# Writing R Code in RMarkdown

To run R code in an RMarkdown document, use R code chunks. A basic chunk looks like this:

```{r caculation}
# Simple Calculation
2 + 2
```

You can also assign variables and print output:
```{r object}
x <- 10
y <- 5
x * y
```

# Controlling Code Visibility
RMarkdown allows you to control whether code is displayed in the output using chunk options:

- `echo = FALSE`: Hides the code but shows the output.
- `eval = FALSE`: Shows the code but does not run it.
- `include = FALSE`: Runs the code but hides both the code and output.

Example:
```{r mean result, echo=FALSE}
# This will show the result but not the code
mean(c(1, 2, 3, 4, 5))
```

# Plotting in RMarkdown
You can embed plots using `ggplot2` or base R plotting functions.

```{r figure, fig.width=5, fig.height=4}
library(ggplot2)
ggplot(mtcars, aes(x = mpg, y = hp)) +
  geom_point() +
  theme_minimal()
```

Another example using base R:
```{r}
plot(mtcars$mpg, mtcars$hp, main="MPG vs HP", xlab="Miles per Gallon", ylab="Horsepower", col="blue")
```

# Wide Code Blocks
Use `tidy = TRUE` to ensure readable formatting in long code blocks:

```{r, tidy=TRUE}
# A longer code snippet
long_vector <- rep(1:10, each=3)
summary(long_vector)
```

# Formatting Text in RMarkdown
You can format text using:

- **Bold**: `**bold text**`
- *Italic*: `*italic text*`
- `Monospace`: `` `code` ``
- Bullet points: `- Item 1`, `- Item 2`
- Headers: `# Heading 1`, `## Heading 2`, `### Heading 3`
- Blockquotes:
  > This is a blockquote.
- Inline code: `r inline_code_example <- 42`

# Adding Tables
You can add tables using the `knitr::kable` function:
```{r}
library(knitr)
df <- data.frame(Name = c("Alice", "Bob"), Age = c(25, 30))
kable(df)
```

# Adding Mathematical Equations
RMarkdown supports LaTeX-style mathematical equations. You can write inline equations using `$...$`, like this: $N_{t+1} = N_t e^{rt}$. 

For display equations, use double dollar signs:

$$
N_{t+1} = N_t e^{rt}
$$

where:
- \( N_t+1 \) is the population at time \( t+1 \),
- \( N_t \) is the initial population,
- \( r \) is the growth rate,
- \( t \) is time.

# Citing Papers
You can cite papers using a bibliography file in BibTeX format. First, create a file called `references.bib`. 
In RStudio, go to File > New File > Text File. Copy and paste the following BibTeX entry format into the new file:

```
@article{smith2020,
  author = {John Smith},
  title = {An Introduction to RMarkdown},
  journal = {Journal of R},
  year = {2020},
  volume = {10},
  pages = {1-10}
}
```
Save the file as `references.bib` in the same directory as your RMarkdown document.

Then, you can cite the paper in your document using `@smith2020`, like this:

> RMarkdown is a great tool for reproducible research [@smith2020].

The references will be automatically formatted at the end of your document.

For this to work make sure you have the `apa.csl` file in the same directory as your RMarkdown document. If you don’t have it, you can download it from the Zotero repository:

1. Go to [CSL Repository](https://www.zotero.org/styles?q=apa). 
2. Search for APA (American Psychological Association) 7th edition.
3. Download the `.csl` file.
4. Place it in the same folder as your `.Rmd` file.


# Customizing HTML Formatting

You can customize the HTML output using CSS or RMarkdown options.

- Change the theme with:
  ```
  output: 
    html_document:
      theme: cerulean
  ```
- Use custom CSS:
  ```
  output: 
    html_document:
      css: styles.css
  ```
- Add a table of contents:
  ```
  output: 
    html_document:
      toc: true
      toc_float: true
  ```

# References 
